resources:
  jobs:
    #{DATABRICKS_ENVIRONMENT_LOWER}#_#{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_NAME}#_job:
      name: #{DATABRICKS_ENVIRONMENT_LOWER}#_#{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_NAME}#_job
      description: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_DESCRIPTION}#
      webhook_notifications:
        on_start:
          - id: #{DATABRICKS_SLACK_WEBHOOK}#
        on_success:
          - id: #{DATABRICKS_SLACK_WEBHOOK}#
        on_failure:
          - id: #{DATABRICKS_SLACK_WEBHOOK}#
        on_duration_warning_threshold_exceeded:
          - id: #{DATABRICKS_SLACK_WEBHOOK}#
      timeout_seconds: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_TIMEOUT_IN_SECONDS}#
      health:
        rules:
          - metric: RUN_DURATION_SECONDS
            op: GREATER_THAN
            value: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_WARNING_IN_SECONDS}#
      schedule:
        quartz_cron_expression: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_SCHEDULE_CRON}#
        timezone_id: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_SCHEDULE_TIMEZONE}#
        pause_status: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_SCHEDULE_STATUS}#
      tasks:
        - task_key: #{DATABRICKS_ENVIRONMENT_LOWER}#_#{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_NAME}#_task
          notebook_task:
            notebook_path: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_PATH}#
            base_parameters:
              environment_task: #{DATABRICKS_ENVIRONMENT_LOWER}#
            source: WORKSPACE
          job_cluster_key: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_NAME}#_cluster
          max_retries: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_RETRIES}#
          min_retry_interval_millis: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_RETRY_INTERVAL_IN_MS}#
          retry_on_timeout: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_RETRY_IN_TIMEOUT}#
          timeout_seconds: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_TIMEOUT_IN_SECONDS}#
          health:
            rules:
              - metric: RUN_DURATION_SECONDS
                op: GREATER_THAN
                value: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_1_WARNING_IN_SECONDS}#
          webhook_notifications:
            on_start:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_success:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_failure:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_duration_warning_threshold_exceeded:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
        - task_key: #{DATABRICKS_ENVIRONMENT_LOWER}#_#{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_NAME}#_task
          depends_on:
            - task_key: #{DATABRICKS_ENVIRONMENT_LOWER}#_#{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_DEPENDS_ON}#_task
          notebook_task:
            notebook_path: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_PATH}#
            base_parameters:
              environment_task: #{DATABRICKS_ENVIRONMENT_LOWER}#
            source: GIT
          job_cluster_key: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_NAME}#_cluster
          max_retries: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_RETRIES}#
          min_retry_interval_millis: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_RETRY_INTERVAL_IN_MS}#
          retry_on_timeout: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_RETRY_IN_TIMEOUT}#
          timeout_seconds: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_TIMEOUT_IN_SECONDS}#
          health:
            rules:
              - metric: RUN_DURATION_SECONDS
                op: GREATER_THAN
                value: #{DATABRICKS_JOB_RECEITA_FEDERAL_TASK_2_WARNING_IN_SECONDS}#
          webhook_notifications:
            on_start:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_success:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_failure:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
            on_duration_warning_threshold_exceeded:
              - id: #{DATABRICKS_SLACK_WEBHOOK}#
      job_clusters:
        - job_cluster_key: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_NAME}#_cluster
          new_cluster:
            cluster_name: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_NAME}#_cluster
            spark_version: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_SPARK_VERSION}#
            azure_attributes:
              first_on_demand: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_SPOT_FIRST_ON_DEMAND}#
              availability: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_SPOT_AVAILABILITY}#
              spot_bid_max_price: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_SPOT_BID_MAX_PRICE}#
            node_type_id: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_NODE_TYPE}
            driver_node_type_id: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_DRIVER_TYPE}#
            spark_env_vars:
              PYSPARK_PYTHON: /databricks/python3/bin/python3
              ENVIRONMENT_CLUSTER: #{DATABRICKS_ENVIRONMENT_LOWER}#
            enable_elastic_disk: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_ENABLE_ELASTIC_DISK}#
            data_security_mode: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_DATA_SECURITY_MODE}#
            runtime_engine: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_RUNTIME_ENGINE}#
            autoscale:
              min_workers: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_AUTOSCALE_MIN_WORKER}#
              max_workers: #{DATABRICKS_JOB_RECEITA_FEDERAL_JOB_CLUSTER_AUTOSCALE_MAX_WORKER}#
      tags:
        environment_job: #{DATABRICKS_ENVIRONMENT_LOWER}#
      parameters:
        - name: environment_param_job
          default: #{DATABRICKS_ENVIRONMENT_LOWER}#
